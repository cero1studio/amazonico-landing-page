{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/javiermayorga/Documents/repos/v0-amazonico-landing-page/app/api/wompi/create-session/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n\n    // Validar datos requeridos\n    const requiredFields = ['name', 'email', 'phone', 'address', 'city', 'department', 'documentType', 'documentNumber', 'amount']\n    for (const field of requiredFields) {\n      if (!body[field]) {\n        return NextResponse.json(\n          { error: `Campo requerido faltante: ${field}` },\n          { status: 400 }\n        )\n      }\n    }\n\n    // Credenciales de Wompi\n    const WOMPI_PUBLIC_KEY = process.env.NEXT_PUBLIC_WOMPI_PUBLIC_KEY\n    const WOMPI_ENVIRONMENT = process.env.WOMPI_ENVIRONMENT || 'test'\n\n    if (!WOMPI_PUBLIC_KEY) {\n      return NextResponse.json(\n        { error: 'Configuración de Wompi incompleta' },\n        { status: 500 }\n      )\n    }\n\n    // Crear referencia única\n    const reference = body.reference || `AMAZONIICO-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n\n    // Incluir instrucciones en la descripción si existen\n    let description = body.description || `${body.productName || 'Amazoniico Colágeno Marino'}`\n    if (body.instructions && body.instructions.trim()) {\n      description += ` - ${body.instructions.substring(0, 100)}`\n    }\n\n    // Construir URL del widget de Wompi con todos los parámetros\n    const amountInCents = Math.round(body.amount * 100)\n    const redirectUrl = `${process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'}/checkout/success?reference=${encodeURIComponent(reference)}`\n\n    // Mapear el método de pago seleccionado\n    const paymentMethodMap: Record<string, string> = {\n      'pse': 'PSE',\n      'card': 'CARD',\n      'bancolombia': 'BANCOLOMBIA_TRANSFER'\n    }\n\n    const selectedPaymentMethod = body.paymentMethod ? paymentMethodMap[body.paymentMethod] : 'PSE'\n\n    const widgetParams = new URLSearchParams({\n      'public-key': WOMPI_PUBLIC_KEY,\n      'currency': 'COP',\n      'amount-in-cents': amountInCents.toString(),\n      'reference': reference,\n      'redirect-url': redirectUrl,\n    })\n\n    // Agregar datos del cliente\n    if (body.email) widgetParams.append('customer-data:email', body.email)\n    if (body.name) widgetParams.append('customer-data:full-name', body.name)\n    if (body.phone) widgetParams.append('customer-data:phone-number', body.phone)\n    if (body.documentNumber) widgetParams.append('customer-data:legal-id', body.documentNumber)\n    if (body.documentType) widgetParams.append('customer-data:legal-id-type', body.documentType)\n\n    // Preseleccionar método de pago\n    if (selectedPaymentMethod) {\n      widgetParams.append('payment-method', selectedPaymentMethod)\n    }\n\n    const baseUrl = WOMPI_ENVIRONMENT === 'production'\n      ? 'https://checkout.wompi.co/p/'\n      : 'https://checkout.wompi.co/p/'\n\n    const checkoutUrl = `${baseUrl}?${widgetParams.toString()}`\n\n    console.log('URL de checkout generada:', checkoutUrl)\n    console.log('Método de pago preseleccionado:', selectedPaymentMethod)\n\n    // Retornar URL de checkout\n    return NextResponse.json({\n      checkoutUrl,\n      reference,\n      sessionId: reference,\n    })\n  } catch (error) {\n    console.error('Error en create-session:', error)\n    return NextResponse.json(\n      { error: 'Error interno del servidor', details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,2BAA2B;QAC3B,MAAM,iBAAiB;YAAC;YAAQ;YAAS;YAAS;YAAW;YAAQ;YAAc;YAAgB;YAAkB;SAAS;QAC9H,KAAK,MAAM,SAAS,eAAgB;YAClC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBAChB,OAAO,4MAAY,CAAC,IAAI,CACtB;oBAAE,OAAO,CAAC,0BAA0B,EAAE,OAAO;gBAAC,GAC9C;oBAAE,QAAQ;gBAAI;YAElB;QACF;QAEA,wBAAwB;QACxB,MAAM;QACN,MAAM,oBAAoB,QAAQ,GAAG,CAAC,iBAAiB,IAAI;QAE3D;;QAOA,yBAAyB;QACzB,MAAM,YAAY,KAAK,SAAS,IAAI,CAAC,WAAW,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;QAEzG,qDAAqD;QACrD,IAAI,cAAc,KAAK,WAAW,IAAI,GAAG,KAAK,WAAW,IAAI,8BAA8B;QAC3F,IAAI,KAAK,YAAY,IAAI,KAAK,YAAY,CAAC,IAAI,IAAI;YACjD,eAAe,CAAC,GAAG,EAAE,KAAK,YAAY,CAAC,SAAS,CAAC,GAAG,MAAM;QAC5D;QAEA,6DAA6D;QAC7D,MAAM,gBAAgB,KAAK,KAAK,CAAC,KAAK,MAAM,GAAG;QAC/C,MAAM,cAAc,GAAG,6DAAoC,wBAAwB,4BAA4B,EAAE,mBAAmB,YAAY;QAEhJ,wCAAwC;QACxC,MAAM,mBAA2C;YAC/C,OAAO;YACP,QAAQ;YACR,eAAe;QACjB;QAEA,MAAM,wBAAwB,KAAK,aAAa,GAAG,gBAAgB,CAAC,KAAK,aAAa,CAAC,GAAG;QAE1F,MAAM,eAAe,IAAI,gBAAgB;YACvC,cAAc;YACd,YAAY;YACZ,mBAAmB,cAAc,QAAQ;YACzC,aAAa;YACb,gBAAgB;QAClB;QAEA,4BAA4B;QAC5B,IAAI,KAAK,KAAK,EAAE,aAAa,MAAM,CAAC,uBAAuB,KAAK,KAAK;QACrE,IAAI,KAAK,IAAI,EAAE,aAAa,MAAM,CAAC,2BAA2B,KAAK,IAAI;QACvE,IAAI,KAAK,KAAK,EAAE,aAAa,MAAM,CAAC,8BAA8B,KAAK,KAAK;QAC5E,IAAI,KAAK,cAAc,EAAE,aAAa,MAAM,CAAC,0BAA0B,KAAK,cAAc;QAC1F,IAAI,KAAK,YAAY,EAAE,aAAa,MAAM,CAAC,+BAA+B,KAAK,YAAY;QAE3F,gCAAgC;QAChC,IAAI,uBAAuB;YACzB,aAAa,MAAM,CAAC,kBAAkB;QACxC;QAEA,MAAM,UAAU,sBAAsB,eAClC,iCACA;QAEJ,MAAM,cAAc,GAAG,QAAQ,CAAC,EAAE,aAAa,QAAQ,IAAI;QAE3D,QAAQ,GAAG,CAAC,6BAA6B;QACzC,QAAQ,GAAG,CAAC,mCAAmC;QAE/C,2BAA2B;QAC3B,OAAO,4MAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA,WAAW;QACb;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,4MAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAA8B,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAgB,GACzG;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}