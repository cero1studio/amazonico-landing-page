{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Usuario/REPOS/v0-amazonico-landing-page/app/api/wompi/create-session/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json()\r\n\r\n    // Validar solo datos básicos requeridos\r\n    const requiredFields = ['name', 'email', 'phone', 'amount']\r\n    for (const field of requiredFields) {\r\n      if (!body[field]) {\r\n        return NextResponse.json(\r\n          { error: `Campo requerido faltante: ${field}` },\r\n          { status: 400 }\r\n        )\r\n      }\r\n    }\r\n\r\n    // Credenciales de Wompi\r\n    const WOMPI_PUBLIC_KEY = process.env.NEXT_PUBLIC_WOMPI_PUBLIC_KEY\r\n    const WOMPI_ENVIRONMENT = process.env.WOMPI_ENVIRONMENT || 'test'\r\n\r\n    if (!WOMPI_PUBLIC_KEY) {\r\n      return NextResponse.json(\r\n        { error: 'Configuración de Wompi incompleta' },\r\n        { status: 500 }\r\n      )\r\n    }\r\n\r\n    // Crear referencia única\r\n    const reference = body.reference || `AMAZONIICO-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\r\n\r\n    // Construir descripción desde cartItems o description\r\n    let description = body.description || 'Amazoniico Colágeno Marino'\r\n    if (body.cartItems && Array.isArray(body.cartItems) && body.cartItems.length > 0) {\r\n      const itemsDescription = body.cartItems.map((item: any) => \r\n        `${item.quantity}x ${item.name}`\r\n      ).join(', ')\r\n      description = `Amazoniico Colágeno Marino - ${itemsDescription}`\r\n    }\r\n\r\n    // Construir URL del widget de Wompi con todos los parámetros\r\n    const amountInCents = Math.round(body.amount * 100)\r\n    const redirectUrl = `${process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'}/checkout/success?reference=${encodeURIComponent(reference)}`\r\n\r\n    // No preseleccionar método de pago - el usuario lo seleccionará en Wompi\r\n\r\n    const widgetParams = new URLSearchParams({\r\n      'public-key': WOMPI_PUBLIC_KEY,\r\n      'currency': 'COP',\r\n      'amount-in-cents': amountInCents.toString(),\r\n      'reference': reference,\r\n      'redirect-url': redirectUrl,\r\n    })\r\n\r\n    // Agregar solo datos básicos del cliente (el resto se completa en Wompi)\r\n    if (body.email) widgetParams.append('customer-data:email', body.email)\r\n    if (body.name) widgetParams.append('customer-data:full-name', body.name)\r\n    if (body.phone) widgetParams.append('customer-data:phone-number', body.phone)\r\n\r\n    const baseUrl = WOMPI_ENVIRONMENT === 'production'\r\n      ? 'https://checkout.wompi.co/p/'\r\n      : 'https://checkout.wompi.co/p/'\r\n\r\n    const checkoutUrl = `${baseUrl}?${widgetParams.toString()}`\r\n\r\n    console.log('URL de checkout generada:', checkoutUrl)\r\n    console.log('Descripción:', description)\r\n\r\n    // Retornar URL de checkout\r\n    return NextResponse.json({\r\n      checkoutUrl,\r\n      reference,\r\n      sessionId: reference,\r\n    })\r\n  } catch (error) {\r\n    console.error('Error en create-session:', error)\r\n    return NextResponse.json(\r\n      { error: 'Error interno del servidor', details: error instanceof Error ? error.message : 'Unknown error' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,wCAAwC;QACxC,MAAM,iBAAiB;YAAC;YAAQ;YAAS;YAAS;SAAS;QAC3D,KAAK,MAAM,SAAS,eAAgB;YAClC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO,CAAC,0BAA0B,EAAE,OAAO;gBAAC,GAC9C;oBAAE,QAAQ;gBAAI;YAElB;QACF;QAEA,wBAAwB;QACxB,MAAM;QACN,MAAM,oBAAoB,QAAQ,GAAG,CAAC,iBAAiB,IAAI;QAE3D;;QAOA,yBAAyB;QACzB,MAAM,YAAY,KAAK,SAAS,IAAI,CAAC,WAAW,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;QAEzG,sDAAsD;QACtD,IAAI,cAAc,KAAK,WAAW,IAAI;QACtC,IAAI,KAAK,SAAS,IAAI,MAAM,OAAO,CAAC,KAAK,SAAS,KAAK,KAAK,SAAS,CAAC,MAAM,GAAG,GAAG;YAChF,MAAM,mBAAmB,KAAK,SAAS,CAAC,GAAG,CAAC,CAAC,OAC3C,GAAG,KAAK,QAAQ,CAAC,EAAE,EAAE,KAAK,IAAI,EAAE,EAChC,IAAI,CAAC;YACP,cAAc,CAAC,6BAA6B,EAAE,kBAAkB;QAClE;QAEA,6DAA6D;QAC7D,MAAM,gBAAgB,KAAK,KAAK,CAAC,KAAK,MAAM,GAAG;QAC/C,MAAM,cAAc,GAAG,6DAAoC,wBAAwB,4BAA4B,EAAE,mBAAmB,YAAY;QAEhJ,yEAAyE;QAEzE,MAAM,eAAe,IAAI,gBAAgB;YACvC,cAAc;YACd,YAAY;YACZ,mBAAmB,cAAc,QAAQ;YACzC,aAAa;YACb,gBAAgB;QAClB;QAEA,yEAAyE;QACzE,IAAI,KAAK,KAAK,EAAE,aAAa,MAAM,CAAC,uBAAuB,KAAK,KAAK;QACrE,IAAI,KAAK,IAAI,EAAE,aAAa,MAAM,CAAC,2BAA2B,KAAK,IAAI;QACvE,IAAI,KAAK,KAAK,EAAE,aAAa,MAAM,CAAC,8BAA8B,KAAK,KAAK;QAE5E,MAAM,UAAU,sBAAsB,eAClC,iCACA;QAEJ,MAAM,cAAc,GAAG,QAAQ,CAAC,EAAE,aAAa,QAAQ,IAAI;QAE3D,QAAQ,GAAG,CAAC,6BAA6B;QACzC,QAAQ,GAAG,CAAC,gBAAgB;QAE5B,2BAA2B;QAC3B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA,WAAW;QACb;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAA8B,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAgB,GACzG;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}